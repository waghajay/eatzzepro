{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- All Meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="keywords" content="" />
    <meta name="author" content="DexignLab" />
    <meta name="robots" content="" />
    <meta name="description" content="EatzzePro - A SaaS platform for restaurants to manage menus, generate QR codes, and streamline customer orders." />
    <meta property="og:title" content="EatzzePro - Simplify Restaurant Management with SaaS" />
    <meta property="og:description" content="EatzzePro is a SaaS platform empowering restaurants to register, add menus, generate QR codes for tables, and enhance the customer dining experience." />
    <meta name="format-detection" content="telephone=no">
    <!-- Mobile Specific -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- PAGE TITLE HERE -->
    <title>EatzzePro - Online Food Delivery Admin Dashboard</title>
    <!-- FAVICONS ICON -->
    <link rel="shortcut icon" type="image/png" href="{% static 'global/images/favicon.png' %}" />
    <!-- Stylesheet -->
    <link href="{% static 'global/vendor/jquery-nice-select/css/nice-select.css' %}" rel="stylesheet">
    <link href="{% static 'global/vendor/swiper/css/swiper-bundle.min.css' %}" rel="stylesheet">
    <link href="{% static 'global/vendor/bootstrap-datetimepicker/css/bootstrap-datetimepicker.min.css' %}" rel="stylesheet">
    <link href="{% static 'global/vendor/bootstrap-select/dist/css/bootstrap-select.min.css' %}" rel="stylesheet">
    <!-- Style css -->
    <link href="{% static 'global/vendor/swiper/css/swiper-bundle.min.css' %}" rel="stylesheet">
    <!-- Global Stylesheet -->
    <link href="{% static 'global/css/style.css' %}" rel="stylesheet">
  </head>
<body>
<!--*******************
        Preloader start
    ********************-->
    <div id="preloader">
      <div class="lds-ripple">
        <div></div>
        <div></div>
      </div>
    </div>
    <!--*******************
        Preloader end
    ********************-->
    <!--**********************************
        Main wrapper start
    ***********************************-->
    <div id="main-wrapper">
      <!--**********************************
            Nav header start
        ***********************************-->
      <div class="nav-header">
        <a href="" class="brand-logo">

        </a>
        <div class="nav-control">
          <div class="hamburger">
            <span class="line"></span>
            <span class="line"></span>
            <span class="line"></span>
          </div>
        </div>
      </div>
      <!--**********************************
            Nav header end
        ***********************************-->
      <!--**********************************
            Header start
        ***********************************-->
      <div class="header">
        <div class="header-content">
          <nav class="navbar navbar-expand">
            <div class="container d-block my-0"></div>
          </nav>
        </div>
      </div>
      <!--**********************************
            Header end ti-comment-alt
        ***********************************-->
      <!--**********************************
            Sidebar start
        ***********************************-->
      <div class="dlabnav border-right">
        <div class="dlabnav-scroll">
          <p class="menu-title style-1"> Main Menu</p>
          <ul class="metismenu" id="menu">
            <li>
              <a class="has-arrow " href="javascript:void(0);" aria-expanded="false">
                <i class="bi bi-grid"></i>
                <span class="nav-text">Dashboard</span>
              </a>
              <ul aria-expanded="false">
                <li>
                  <a href="#">Order History</a>
                </li>
                <li>
                  <a href="order-history.html">Review</a>
                </li>
              </ul>

          </ul>
        </div>
      </div>
      <!--**********************************
            Sidebar end
        ***********************************-->
		
		<!--**********************************
            Content body start
        ***********************************-->
        <style>
          .card {
            min-height: 400px; /* Set a baseline height for the cards */
            display: flex;
            flex-direction: column;
            justify-content: space-between; /* Ensure content is spaced evenly */
          }
          .order-menu {
            flex-grow: 1; /* Allows the menu to take up remaining space */
          }
          .order-items {
            overflow-y: auto; /* Adds scroll if content exceeds available space */
            max-height: 200px; /* Restricts the height for long lists */
          }
        </style>

        <div class="content-body">
            <!-- row -->
             
            {% if messages %} <div style="font-size: 20px;" class="container mt-3"> {% for message in messages %} <div class="alert {{ message.tags }} alert-dismissible fade show" role="alert">
              {{ message }}
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div> {% endfor %} </div> {% endif %}

            <div class="container">
              <div class="row">
                <div class="col-xl-8 col-xxl-12">
                  <div class="row">
                    {% if orders %}
                      {% for order in orders %}
                        <div class="col-xl-4 col-sm-6 sp15 mb-4">
                          <div class="card h-auto b-hover">
                            <div class="card-body px-3">
                              <div class="text-center">
                                <h4>Order ID: {{ order.id }}</h4>
                                <h5>Table Number: {{ order.table_Number }}</h5>
                                <p>{{ order.created_at|date:"M d, Y, H:i A" }}</p>
                              </div>
                              <hr>
                              <div class="order-menu">
                                <h6 class="font-w600">Order Menu</h6>
                                <hr>
                                <div class="order-items">
                                  {% for item in order.items.all %}
                                    <div class="d-flex align-items-center mb-2">
                                      <div>
                                        <h6 class="font-w500 text-nowrap mb-0">
                                          <a href="javascript:void(0);">{{ item.menu_item.name }}</a>
                                        </h6>
                                        <p class="mb-0">x{{ item.quantity }}</p>
                                      </div>
                                      <h6 class="text-primary mb-0 ms-auto">₹{{ item.price }}</h6>
                                    </div>
                                  {% endfor %}
                                </div>
                              </div>
                              <hr>
                              <div class="d-flex align-items-center justify-content-between">
                                <h4 class="mb-0">Total</h4>
                                <h4 class="mb-0 text-primary">₹{{ order.total_price }}</h4>
                              </div>
                              <a href="javascript:void(0);"
                                 class="btn btn-block mt-3"
                                 style="background-color: {% if order.order_status == 'Pending' %}#ffc107{% elif order.order_status == 'Accepted' %}#28a745{% elif order.order_status == 'Rejected' %}#dc3545{% else %}#6c757d{% endif %};color: #fff;">
                                Status :- {{ order.order_status }}
                              </a>
            
                              <!-- Review Section -->
                              <hr>
                              {% if order.review %}
                                <!-- Display submitted review -->
                                <div class="review-section mt-3">
                                  <h6 class="mb-3">Your Review:</h6>
                                  
                                  <!-- Review Card -->
                                  <div class="shadow-sm">
                                    <div class="card-body">
                                      <div class="d-flex justify-content-between align-items-center mb-3">
                                        <div>
                                          <h5 class="card-title mb-0">Rating:</h5>
                                        </div>
                                        <div class="text-warning">
                                          <!-- Display the rating as stars -->
                                          {% for star in order.stars %}
                                            {% if star == 'filled' %}
                                              <i class="fas fa-star"></i>
                                            {% else %}
                                              <i class="far fa-star"></i>
                                            {% endif %}
                                          {% endfor %}
                                        </div>
                                      </div>
                                
                                      <div class="mb-3">
                                        <h6>Review:</h6>
                                        <p class="text-muted">{{ order.review.review_text }}</p>
                                      </div>
                                      
                                      <div class="d-flex justify-content-between align-items-center">
                                        <small class="text-muted">Reviewed on: {{ order.review.created_at|date:"M d, Y, H:i A" }}</small>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                                
                              {% else %}
                                <!-- Show review form if no review is submitted -->
                                <div class="review-section mt-3">
                                  <h6>Leave a Review:</h6>
                                  <form method="POST" action="{% url 'submit_review' order.id %}">
                                    {% csrf_token %}
                                    <textarea class="form-control mb-2" name="review" rows="3" placeholder="Write your review here..." required></textarea>
                                    <div class="d-flex justify-content-between align-items-center">
                                      <select name="rating" class="form-select w-50 me-2" required>
                                        <option value="" disabled selected>Rating</option>
                                        <option value="1">1 - Poor</option>
                                        <option value="2">2 - Fair</option>
                                        <option value="3">3 - Good</option>
                                        <option value="4">4 - Very Good</option>
                                        <option value="5">5 - Excellent</option>
                                      </select>
                                      <button type="submit" class="btn btn-primary w-50">Submit</button>
                                    </div>
                                  </form>
                                </div>
                              {% endif %}
                            </div>
                          </div>
                        </div>
                      {% endfor %}
                    {% else %}
                      <div class="alert alert-warning col-12 text-center">No orders found for this session.</div>
                    {% endif %}
                  </div>
                </div>
              </div>
            </div>
            

        <!--**********************************
            Content body end
        ***********************************-->
		

		<!--**********************************
           Support ticket button start
        ***********************************-->
		
        <!--**********************************
           Support ticket button end
        ***********************************-->


	</div>
    <!--**********************************
        Main wrapper end
    ***********************************-->

    <!--**********************************
        Scripts
    ***********************************-->
    <!-- Required vendors -->
    <script src="{% static 'global/vendor/global/global.min.js' %}">></script>
	<script src="{% static 'global/vendor/bootstrap-select/dist/js/bootstrap-select.min.js' %}"></script>
	<script src="{% static 'global/vendor/chart.js/Chart.bundle.min.js' %}"></script>
	<script src="{% static 'global/vendor/jquery-nice-select/js/jquery.nice-select.min.js' %}"></script>
	<script src="{% static 'global/vendor/bootstrap-select/dist/js/bootstrap-select.min.js' %}"></script>
	<script src="{% static 'global/vendor/swiper/js/swiper-bundle.min.js' %}"></script>
	
	<!-- Apex Chart -->
	<!-- Dashboard 1 -->
    <script src="{% static 'global/js/custom.js' %}"></script>
	<script src="{% static 'global/js/dlabnav-init.js' %}"></script>
	<script src="{% static 'global/js/demo.js' %}"></script>
    <script src="{% static 'global/js/styleSwitcher.js' %}"></script>
	<script>
		$('.my-select').selectpicker();

	</script>

  <script>
    setInterval(function() {
      window.location.reload();
    }, 10000);
  </script>
</body>
</html>